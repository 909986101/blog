<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/Tiger-32x32.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/Tiger-32x32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/Tiger-16x16.jpg">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ilxy.tech","root":"/blog/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="19c Standalone（Oralce Restart）">
<meta property="og:type" content="article">
<meta property="og:title" content="OCP 0002 19c Standalone Oracle Restart">
<meta property="og:url" content="https://ilxy.tech/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/index.html">
<meta property="og:site_name" content="haona_li&#39;s Blog">
<meta property="og:description" content="19c Standalone（Oralce Restart）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-04-04T12:34:11.000Z">
<meta property="article:modified_time" content="2020-04-08T02:37:13.698Z">
<meta property="article:author" content="haona_li">
<meta property="article:tag" content="oracle">
<meta property="article:tag" content="ocp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ilxy.tech/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>OCP 0002 19c Standalone Oracle Restart | haona_li's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">haona_li's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">书山有路勤为径，学海无涯苦作舟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">23</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">28</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/909986101" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ilxy.tech/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/Tiger.jpg">
      <meta itemprop="name" content="haona_li">
      <meta itemprop="description" content="百川东到海，何时复西归">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="haona_li's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OCP 0002 19c Standalone Oracle Restart
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-04 20:34:11" itemprop="dateCreated datePublished" datetime="2020-04-04T20:34:11+08:00">2020-04-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-08 10:37:13" itemprop="dateModified" datetime="2020-04-08T10:37:13+08:00">2020-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/oracle/" itemprop="url" rel="index"><span itemprop="name">oracle</span></a>
                </span>
            </span>

          
            <span id="/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/" class="post-meta-item leancloud_visitors" data-flag-title="OCP 0002 19c Standalone Oracle Restart" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>19c Standalone（Oralce Restart）</p>
<a id="more"></a>
<h1 id="19c-Standalone（Oralce-Restart）"><a href="#19c-Standalone（Oralce-Restart）" class="headerlink" title="19c Standalone（Oralce Restart）"></a>19c Standalone（Oralce Restart）</h1><h2 id="操作系统配置"><a href="#操作系统配置" class="headerlink" title="操作系统配置"></a>操作系统配置</h2><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># systemctl disable firewalld</span><br><span class="line"># systemctl stop firewalld</span><br><span class="line"># systemctl disable iptables</span><br><span class="line"># systemctl stop iptables</span><br></pre></td></tr></table></figure>

<h3 id="禁用-Selinux"><a href="#禁用-Selinux" class="headerlink" title="禁用 Selinux"></a>禁用 Selinux</h3><p>临时关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># setenforce 0</span><br></pre></td></tr></table></figure>

<p>持久化修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sed -i &#39;&#x2F;^SELINUX&#x3D;&#x2F;c\SELINUX&#x3D;disabled&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br></pre></td></tr></table></figure>

<h3 id="用户、组、目录和环境变量"><a href="#用户、组、目录和环境变量" class="headerlink" title="用户、组、目录和环境变量"></a>用户、组、目录和环境变量</h3><p><strong>添加 oracle 和 grid 用户</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 54321 oinstall  </span><br><span class="line">groupadd -g 54322 dba  </span><br><span class="line">groupadd -g 54323 oper  </span><br><span class="line">groupadd -g 54324 backupdba  </span><br><span class="line">groupadd -g 54325 dgdba  </span><br><span class="line">groupadd -g 54326 kmdba  </span><br><span class="line">groupadd -g 54327 asmdba  </span><br><span class="line">groupadd -g 54328 asmoper  </span><br><span class="line">groupadd -g 54329 asmadmin  </span><br><span class="line">groupadd -g 54330 racdba</span><br><span class="line"></span><br><span class="line">useradd -u 54321 -g oinstall -G dba,asmdba,backupdba,dgdba,kmdba,racdba,oper oracle  </span><br><span class="line">useradd -u 54322 -g oinstall -G asmadmin,asmdba,asmoper,dba,racdba grid</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> &lt;password&gt; | passwd --stdin oracle</span><br><span class="line"><span class="built_in">echo</span> &lt;password&gt; | passwd --stdin grid</span><br></pre></td></tr></table></figure>

<p><strong>创建安装目录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /u01/app/19.3.0/grid</span><br><span class="line">mkdir -p /u01/app/grid</span><br><span class="line">mkdir -p /u01/app/oracle</span><br><span class="line">mkdir -p /u01/app/oracle/product/19.3.0/dbhome_1</span><br><span class="line">chown -R grid:oinstall /u01</span><br><span class="line">chown -R oracle:oinstall /u01/app/oracle</span><br><span class="line">chmod -R 775 /u01/</span><br><span class="line"></span><br><span class="line">mkdir -p /u01/app/oraInventory</span><br><span class="line">chown -R grid:oinstall /u01/app/oraInventory</span><br><span class="line">chmod -R 775 /u01/app/oraInventory</span><br></pre></td></tr></table></figure>

<p><strong>配置 grid 和 oracle 用户的环境变量文件</strong></p>
<p>oracle 用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi &#x2F;home&#x2F;oracle&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>

<p>未完待续……</p>
<p>grid 用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi &#x2F;home&#x2F;grid&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>

<p>未完待续……</p>
<p><strong>配置 root 用户的环境变量</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;grid</span><br><span class="line">export ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid</span><br><span class="line">export GRID_HOME&#x3D;$ORACLE_HOME</span><br></pre></td></tr></table></figure>

<h3 id="依赖包的检查"><a href="#依赖包的检查" class="headerlink" title="依赖包的检查"></a>依赖包的检查</h3><p>参考官方文档（Database Installation Guide）</p>
<p>安装 Oracle 需要的软件包参考</p>
<blockquote>
<p><a href="http://blog.itpub.net/26736162/viewspace-2133603/" target="_blank" rel="noopener">http://blog.itpub.net/26736162/viewspace-2133603/</a></p>
</blockquote>
<p><strong>检查命令</strong></p>
<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">rpm -q --qf <span class="string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125; (%&#123;ARCH&#125;)\n'</span> binutils \</span><br><span class="line">compat-libcap1 \</span><br><span class="line">compat-libstdc++-33 \</span><br><span class="line">gcc \</span><br><span class="line">gcc-c++ \</span><br><span class="line">glibc \</span><br><span class="line">glibc-devel \</span><br><span class="line">ksh \</span><br><span class="line">libgcc \</span><br><span class="line">libstdc++ \</span><br><span class="line">libstdc++-devel \</span><br><span class="line">libaio \</span><br><span class="line">libaio-devel \</span><br><span class="line">libXext \</span><br><span class="line">libXtst \</span><br><span class="line">libX11 \</span><br><span class="line">libXau \</span><br><span class="line">libxcb \</span><br><span class="line">libXi \</span><br><span class="line">make \</span><br><span class="line">elfutils-libelf-devel \</span><br><span class="line">sysstat  | grep <span class="string">"not installed"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -q --qf &#39;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125; (%&#123;ARCH&#125;)\n&#39; compat-libstdc++-33</span><br></pre></td></tr></table></figure>

<p><strong>安装缺失的包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y elfutils-libelf-devel*</span><br><span class="line">yum install -y compat-libstdc++*</span><br><span class="line">yum install -y libaio-devel*</span><br><span class="line">yum install -y ksh*</span><br></pre></td></tr></table></figure>

<p>最后重新检查，确保所有的包已安装。需要注意的是，有的时候由于版本的问题导致检查有问题，所以需要用<code>rpm -qa | grep libstdc</code>来检查。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install binutils compat-libstdc++-33 gcc gcc-c++ glibc glibc.i686 glibc-devel ksh libgcc.i686 libstdc++-devel libaio libaio.i686 libaio-devel libaio-devel.i686 libXext libXext.i686 libXtst libXtst.i686 libX11 libX11.i686 libXau libXau.i686 libxcb libxcb.i686 libXi libXi.i686 make sysstat unixODBC unixODBC-devel zlib-devel zlib-devel.i686 compat-libcap1 -y</span><br></pre></td></tr></table></figure>

<h3 id="配置内核参数"><a href="#配置内核参数" class="headerlink" title="配置内核参数"></a>配置内核参数</h3><p><strong>修改 /etc/sysctl.conf 文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vi &#x2F;etc&#x2F;sysctl.conf</span><br></pre></td></tr></table></figure>

<p>添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness &#x3D; 1</span><br><span class="line">vm.dirty_background_ratio &#x3D; 3</span><br><span class="line">vm.dirty_ratio &#x3D; 80</span><br><span class="line">vm.dirty_expire_centisecs &#x3D; 500</span><br><span class="line">vm.dirty_writeback_centisecs &#x3D; 100</span><br><span class="line">kernel.shmmni &#x3D; 4096</span><br><span class="line">kernel.shmall &#x3D; 1073741824</span><br><span class="line">kernel.shmmax &#x3D; 4398046511104</span><br><span class="line">kernel.sem &#x3D; 250 32000 100 128</span><br><span class="line">net.ipv4.ip_local_port_range &#x3D; 9000 65500</span><br><span class="line">net.core.rmem_default &#x3D; 262144</span><br><span class="line">net.core.rmem_max &#x3D; 4194304</span><br><span class="line">net.core.wmem_default &#x3D; 262144</span><br><span class="line">net.core.wmem_max &#x3D; 1048576</span><br><span class="line">fs.aio-max-nr &#x3D; 1048576</span><br><span class="line">fs.file-max &#x3D; 6815744</span><br><span class="line">kernel.panic_on_oops &#x3D; 1</span><br><span class="line">net.ipv4.conf.enp0s8.rp_filter &#x3D; 2</span><br><span class="line">net.ipv4.conf.enp0s9.rp_filter &#x3D; 2</span><br><span class="line">net.ipv4.conf.enp0s10.rp_filter &#x3D; 2</span><br></pre></td></tr></table></figure>

<p>生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sysctl -p</span><br></pre></td></tr></table></figure>

<p><strong>修改 /etc/security/limits.conf 文件</strong></p>
<p>修改 OS 用户 grid 和 oracle 资源限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cp &#x2F;etc&#x2F;security&#x2F;limits.conf &#x2F;etc&#x2F;security&#x2F;limits.conf.&#96;date +%Y%m%d&#96;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># echo &quot;grid soft nofile 1024</span><br><span class="line">grid hard nofile 65536</span><br><span class="line">grid soft stack 10240</span><br><span class="line">grid hard stack 32768</span><br><span class="line">grid soft nproc 2047</span><br><span class="line">grid hard nproc 16384</span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br><span class="line">oracle hard stack 32768</span><br><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">root soft nproc 2047 &quot; &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure>

<p><strong>修改 /etc/pam.d/login 文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># echo &quot;session   required    pam_limits.so&quot; &gt;&gt; &#x2F;etc&#x2F;pam.d&#x2F;login</span><br></pre></td></tr></table></figure>

<p><strong>修改 /etc/profile 文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$USER</span> = <span class="string">"oracle"</span> ] || [ <span class="variable">$USER</span> = <span class="string">"grid"</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ <span class="variable">$SHELL</span> = <span class="string">"/bin/ksh"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">ulimit</span> -p 16384</span><br><span class="line">            <span class="built_in">ulimit</span> -n 65536</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">ulimit</span> -u 16384 -n 65536</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      <span class="built_in">umask</span> 022</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-dev-shm-大小"><a href="#配置-dev-shm-大小" class="headerlink" title="配置 /dev/shm 大小"></a>配置 /dev/shm 大小</h3><p>不配置会报错：ORA-00845: MEMORY_TARGET not supported on this system，是因为 /dev/shm 的可用空间（非 shm 的总大小）小于了参数文件中设置的 MEMORY_TARGET 值。</p>
<p>增大/dev/shm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vi &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmpfs &#x2F;dev&#x2F;shm tmpfs defaults,size&#x3D;11G 0 0</span><br></pre></td></tr></table></figure>

<p>重新挂载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mount -o remount &#x2F;dev&#x2F;shm</span><br></pre></td></tr></table></figure>

<h2 id="配置-ASM-磁盘"><a href="#配置-ASM-磁盘" class="headerlink" title="配置 ASM 磁盘"></a>配置 ASM 磁盘</h2><h3 id="Faking-方式"><a href="#Faking-方式" class="headerlink" title="Faking 方式"></a>Faking 方式</h3><p>用文件假冒 ASM 磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># raw -qa</span><br><span class="line"># losetup -a</span><br><span class="line"># mknod -m 0660 &#x2F;dev&#x2F;loop9 b 7 9</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /asmdisk</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/asmdisk/disk1 bs=1024k count=2000</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/asmdisk/disk2 bs=1024k count=2000</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/asmdisk/disk3 bs=1024k count=2000</span><br></pre></td></tr></table></figure>

<p>Add the following entries to the file “/etc/rc.local”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sbin&#x2F;losetup &#x2F;dev&#x2F;loop1 &#x2F;asmdisk&#x2F;disk1</span><br><span class="line">&#x2F;sbin&#x2F;losetup &#x2F;dev&#x2F;loop2 &#x2F;asmdisk&#x2F;disk2</span><br><span class="line">&#x2F;sbin&#x2F;losetup &#x2F;dev&#x2F;loop3 &#x2F;asmdisk&#x2F;disk3</span><br><span class="line"></span><br><span class="line">raw &#x2F;dev&#x2F;raw&#x2F;raw1 &#x2F;dev&#x2F;loop1</span><br><span class="line">raw &#x2F;dev&#x2F;raw&#x2F;raw2 &#x2F;dev&#x2F;loop2</span><br><span class="line">raw &#x2F;dev&#x2F;raw&#x2F;raw3 &#x2F;dev&#x2F;loop3</span><br><span class="line"></span><br><span class="line">chmod 660 &#x2F;dev&#x2F;raw&#x2F;raw1</span><br><span class="line">chmod 660 &#x2F;dev&#x2F;raw&#x2F;raw2</span><br><span class="line">chmod 660 &#x2F;dev&#x2F;raw&#x2F;raw3</span><br><span class="line">chown grid:asmadmin &#x2F;dev&#x2F;raw&#x2F;raw1</span><br><span class="line">chown grid:asmadmin &#x2F;dev&#x2F;raw&#x2F;raw2</span><br><span class="line">chown grid:asmadmin &#x2F;dev&#x2F;raw&#x2F;raw3</span><br></pre></td></tr></table></figure>

<h3 id="VMware-Workstation-软件（可做-rac-共享盘）"><a href="#VMware-Workstation-软件（可做-rac-共享盘）" class="headerlink" title="VMware Workstation 软件（可做 rac 共享盘）"></a>VMware Workstation 软件（可做 rac 共享盘）</h3><p>直接添加磁盘，然后做 udev 绑定即可</p>
<p>缺点：只能整块盘绑定</p>
<h3 id="openfiler（可做-rac-共享盘）"><a href="#openfiler（可做-rac-共享盘）" class="headerlink" title="openfiler（可做 rac 共享盘）"></a>openfiler（可做 rac 共享盘）</h3><p>需要部署 openfiler，用来模拟存储</p>
<blockquote>
<p><a href="http://blog.itpub.net/26736162/viewspace-2132858/" target="_blank" rel="noopener">http://blog.itpub.net/26736162/viewspace-2132858/</a></p>
</blockquote>
<h3 id="ASMLIB（可做-rac-共享盘）"><a href="#ASMLIB（可做-rac-共享盘）" class="headerlink" title="ASMLIB（可做 rac 共享盘）"></a>ASMLIB（可做 rac 共享盘）</h3><p>5.x：<a href="http://blog.itpub.net/26736162/viewspace-1401193/" target="_blank" rel="noopener">http://blog.itpub.net/26736162/viewspace-1401193/</a></p>
<p><strong>安装 asmlib</strong></p>
<p>先安装 kmod-oracleasm，再安装 oracleasmlib 和 oracleasm-support</p>
<p>kmod-oracleasm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y kmod-oracleasm</span><br></pre></td></tr></table></figure>

<p>oracleasmlib 和 oracleasm-support</p>
<ul>
<li><a href="https://www.oracle.com/search" target="_blank" rel="noopener">https://www.oracle.com/search</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># wget https:&#x2F;&#x2F;yum.oracle.com&#x2F;repo&#x2F;OracleLinux&#x2F;OL7&#x2F;latest&#x2F;x86_64&#x2F;getPackage&#x2F;oracleasm-support-2.1.11-2.el7.x86_64.rpm</span><br><span class="line"># wget https:&#x2F;&#x2F;download.oracle.com&#x2F;otn_software&#x2F;asmlib&#x2F;oracleasmlib-2.0.12-1.el7.x86_64.rpm</span><br><span class="line"># rpm -ivh *.rpm</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable oracleasm.service</span><br><span class="line"></span><br><span class="line">oracleasm configure -i  # grid,asmadmin,y,y</span><br><span class="line">oracleasm configure -d</span><br><span class="line">oracleasm configure -e</span><br><span class="line"></span><br><span class="line">oracleasm init  #若初始化失败，则尝试重启OS</span><br><span class="line">oracleasm status</span><br><span class="line"></span><br><span class="line">vgreduce vg_orasoft &#x2F;dev&#x2F;sdb8</span><br><span class="line">pvremove &#x2F;dev&#x2F;sdb8 &#x2F;dev&#x2F;sdb9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fdisk -l | grep dev</span><br><span class="line">oracleasm createdisk ASMLIB01 &#x2F;dev&#x2F;sdb8</span><br><span class="line">oracleasm createdisk ASMLIB02 &#x2F;dev&#x2F;sdb9</span><br><span class="line">oracleasm listdisks</span><br><span class="line"># oracleasm renamedisk -f &#x2F;dev&#x2F;sdf1 asmdisk3</span><br></pre></td></tr></table></figure>

<p><strong>oracleasm 常用命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm configure -i</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm createdisk DISK1 &#x2F;dev&#x2F;sdb1    </span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm scandisks</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm listdisks</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm enable</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm restart</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm status</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;oracleasm init</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm enable</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm restart</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm createdisk DISKNAME devicename</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm deletedisk DISKNAME</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm querydisk &#123;DISKNAME | devicename&#125;</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm listdisks</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;oracleasm scandisks</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;dev&#x2F;oracleasm&#x2F;disks</span><br></pre></td></tr></table></figure>

<p>asmlib 配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;sysconfig&#x2F;oracleasm</span><br><span class="line">oracleasm configure</span><br></pre></td></tr></table></figure>

<p>oracleasm 日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f &#x2F;var&#x2F;log&#x2F;oracleasm</span><br></pre></td></tr></table></figure>

<p>查询 ASM 磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># $GRID_HOME&#x2F;bin&#x2F;kfod disks&#x3D;all st&#x3D;true ds&#x3D;true cluster&#x3D;true</span><br><span class="line">asm_diskstring&#x3D;&#39;&#x2F;dev&#x2F;raw&#x2F;raw*&#39;,&#39;&#x2F;dev&#x2F;asm-*&#39;,&#39;&#x2F;dev&#x2F;oracleasm&#x2F;disks&#x2F;*&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set asm_diskstring&#x3D;&#39;&#x2F;dev&#x2F;raw&#x2F;raw*&#39;,&#39;&#x2F;dev&#x2F;asm-*&#39;,&#39;ORCL:*&#39;;</span><br></pre></td></tr></table></figure>

<h3 id="iSCSI-方式（可做-rac-共享盘）"><a href="#iSCSI-方式（可做-rac-共享盘）" class="headerlink" title="iSCSI 方式（可做 rac 共享盘）"></a>iSCSI 方式（可做 rac 共享盘）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># iscsiadm -m node -T iqn.2018-10.org.linux-iscsi.cos73lhr.x8664:sn.lhraxxt20180917 -p 192.168.59.53 –logout</span><br><span class="line"># iscsiadm -m node --logoutall&#x3D;all</span><br><span class="line"># rm -rf &#x2F;var&#x2F;lib&#x2F;iscsi&#x2F;*</span><br><span class="line"># rm -rf &#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;99-oracle-asmdevices.rules</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">targetcli</span><br><span class="line">&gt; ls</span><br><span class="line">&gt; cd &#x2F;iscsi&#x2F;iqn.2003-01.org.linux-iscsi.cos73lhr.x8664:sn.7435eaf5ae5d&#x2F;tpg1&#x2F;portals</span><br><span class="line">&gt; delete 192.168.59.51 3260</span><br><span class="line"># create 0.0.0.0</span><br><span class="line">&gt; create 192.168.59.52</span><br><span class="line">&gt; cd &#x2F;</span><br><span class="line">&gt; saveconfig</span><br><span class="line">&gt; exit</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;iscsi&#x2F;initiatorname.iscsi</span><br><span class="line">#  iqn.2003-01.org.linux-iscsi.cos73lhr.x8664:sn.7435eaf5ae5d</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start target</span><br><span class="line"># systemctl enable iscsid</span><br><span class="line"># systemctl status iscsid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m discovery -t st -p 192.168.59.52</span><br><span class="line">iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.cos73lhr.x8664:sn.7435eaf5ae5d -p 192.168.59.52 --login</span><br></pre></td></tr></table></figure>

<p><strong>udev 绑定</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># fdisk -l | grep dev</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># while scsi_id</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c d e f g h i j k l m n; <span class="keyword">do</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"KERNEL==\"sd*\",ENV&#123;DEVTYPE&#125;==\"disk\",SUBSYSTEM==\"block\",PROGRAM==\"/usr/lib/udev/scsi_id -g -u -d \$devnode\",RESULT==\"`/usr/lib/udev/scsi_id -g -u /dev/sd<span class="variable">$i</span>`\", RUN+=\"/bin/sh -c 'mknod /dev/asm-disk<span class="variable">$i</span> b  \$major \$minor; chown grid:asmadmin /dev/asm-disk<span class="variable">$i</span>; chmod 0660 /dev/asm-disk<span class="variable">$i</span>'\""</span> &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405d8e73735d6e44e1d9a5f3f461&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskc b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskc; chmod 0660 &#x2F;dev&#x2F;asm-diskc&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405315cda11ab7d4f1f9f7d36085&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskd b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskd; chmod 0660 &#x2F;dev&#x2F;asm-diskd&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;360014055beb5701c4f54803b0c9b43b6&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diske b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diske; chmod 0660 &#x2F;dev&#x2F;asm-diske&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;3600140598d211f7135f447993f791450&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskf b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskf; chmod 0660 &#x2F;dev&#x2F;asm-diskf&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405fdd6814654ed4e3289bca25dc&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskg b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskg; chmod 0660 &#x2F;dev&#x2F;asm-diskg&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;360014054e87839630c742749c47cfbbe&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskh b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskh; chmod 0660 &#x2F;dev&#x2F;asm-diskh&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;360014051a51f44f304c4779a4dc1db5b&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diski b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diski; chmod 0660 &#x2F;dev&#x2F;asm-diski&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405c54256a24d134511a2728470b&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskj b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskj; chmod 0660 &#x2F;dev&#x2F;asm-diskj&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;360014059692987bb6644c7b94a12ebc3&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskk b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskk; chmod 0660 &#x2F;dev&#x2F;asm-diskk&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405dc34ba4b43de468bb0e742bf0&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskl b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskl; chmod 0660 &#x2F;dev&#x2F;asm-diskl&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;36001405b2d80fc6807b4bf6950c8ce78&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskm b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskm; chmod 0660 &#x2F;dev&#x2F;asm-diskm&#39;&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;sd*&quot;,ENV&#123;DEVTYPE&#125;&#x3D;&#x3D;&quot;disk&quot;,SUBSYSTEM&#x3D;&#x3D;&quot;block&quot;,PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id -g -u -d $devnode&quot;,RESULT&#x3D;&#x3D;&quot;360014051d939f0d61b04d40b0be5a313&quot;, RUN+&#x3D;&quot;&#x2F;bin&#x2F;sh -c &#39;mknod &#x2F;dev&#x2F;asm-diskn b  $major $minor; chown grid:asmadmin &#x2F;dev&#x2F;asm-diskn; chmod 0660 &#x2F;dev&#x2F;asm-diskn&#39;&quot;</span><br></pre></td></tr></table></figure>

<p>重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;sbin&#x2F;udevadm trigger --type&#x3D;devices --action&#x3D;change</span><br><span class="line"># &#x2F;sbin&#x2F;udevadm control --reload</span><br></pre></td></tr></table></figure>

<p>另一种方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f g h i j k l m; <span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"KERNEL==\"dm-*\", BUS==\"block\", PROGRAM==\"/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/\$name\",RESULT==\"`/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/sd<span class="variable">$i</span>`\",NAME=\"asm-disk<span class="variable">$i</span>\",OWNER=\"grid\",GROUP=\"asmadmin\",MODE=\"0660\""</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;3600140598d211f7135f447993f791450&quot;,NAME&#x3D;&quot;asm-diskf&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;36001405fdd6814654ed4e3289bca25dc&quot;,NAME&#x3D;&quot;asm-diskg&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;360014054e87839630c742749c47cfbbe&quot;,NAME&#x3D;&quot;asm-diskh&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;360014051a51f44f304c4779a4dc1db5b&quot;,NAME&#x3D;&quot;asm-diski&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;36001405c54256a24d134511a2728470b&quot;,NAME&#x3D;&quot;asm-diskj&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;360014059692987bb6644c7b94a12ebc3&quot;,NAME&#x3D;&quot;asm-diskk&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;36001405dc34ba4b43de468bb0e742bf0&quot;,NAME&#x3D;&quot;asm-diskl&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;dm-*&quot;, BUS&#x3D;&#x3D;&quot;block&quot;, PROGRAM&#x3D;&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;udev&#x2F;scsi_id --whitelisted --replace-whitespace --device&#x3D;&#x2F;dev&#x2F;$name&quot;,RESULT&#x3D;&#x3D;&quot;36001405b2d80fc6807b4bf6950c8ce78&quot;,NAME&#x3D;&quot;asm-diskm&quot;,OWNER&#x3D;&quot;grid&quot;,GROUP&#x3D;&quot;asmadmin&quot;,MODE&#x3D;&quot;0660&quot;</span><br></pre></td></tr></table></figure>

<h2 id="数据库软件准备"><a href="#数据库软件准备" class="headerlink" title="数据库软件准备"></a>数据库软件准备</h2><h3 id="上传安装文件"><a href="#上传安装文件" class="headerlink" title="上传安装文件"></a>上传安装文件</h3><p>上传至 /soft</p>
<h3 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ unzip &#x2F;soft&#x2F;LINUX.X64_193000_grid_home.zip -d &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su - oracle</span><br><span class="line">$ unzip &#x2F;soft&#x2F;LINUX.X64_193000_db_home.zip -d &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.3.0&#x2F;dbhome_1</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：18c 起解压缩的文件所在目录就是 grid home，所以解压的时候，就要把文件解压到之前定的 GRID_HOME 下。</p>
<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kill -9 &#96;ps -ef|grep d.bin| grep -v grep | awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line"># rm -rf &#x2F;etc&#x2F;ora*</span><br><span class="line"># rm -rf &#x2F;var&#x2F;tmp&#x2F;.oracle</span><br><span class="line"># rm -rf &#x2F;tmp&#x2F;*</span><br><span class="line"># rm -rf &#x2F;u01&#x2F;app&#x2F;*</span><br></pre></td></tr></table></figure>

<p>清除 OCR、Voting 及数据库使用过的磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;raw&#x2F;raw1 bs&#x3D;1024 count&#x3D;1</span><br><span class="line"># dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;asm-diski bs&#x3D;1024 count&#x3D;1</span><br><span class="line"># dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;sdb8 bs&#x3D;1024 count&#x3D;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hexdump -n 1024 -C &#x2F;dev&#x2F;asm-diski</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># oracleasm querydisk -p asmlib1</span><br></pre></td></tr></table></figure>

<h2 id="图形化安装-grid-和-db"><a href="#图形化安装-grid-和-db" class="headerlink" title="图形化安装 grid 和 db"></a>图形化安装 grid 和 db</h2><blockquote>
<p><a href="http://blog.itpub.net/26736162/viewspace-2637602/" target="_blank" rel="noopener">http://blog.itpub.net/26736162/viewspace-2637602/</a></p>
</blockquote>
<h3 id="grid"><a href="#grid" class="headerlink" title="grid"></a>grid</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ export DISPLAY&#x3D;10.0.8.200:0.0</span><br><span class="line">$ &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;gridSetup.sh</span><br></pre></td></tr></table></figure>

<h3 id="db"><a href="#db" class="headerlink" title="db"></a>db</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># su - oracle</span><br><span class="line">$ cd $ORACLE_HOME</span><br><span class="line">$ export DISPLAY&#x3D;10.0.8.200:0.0</span><br><span class="line">$ .&#x2F;runInstaller</span><br></pre></td></tr></table></figure>

<h2 id="静默安装-grid"><a href="#静默安装-grid" class="headerlink" title="静默安装 grid"></a>静默安装 grid</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>响应文件：<code>/u01/app/19.3.0/grid/inventory/response/grid_install.rsp</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;gridSetup.sh -silent  -force -noconfig  -ignorePrereq \</span><br><span class="line">oracle.install.responseFileVersion&#x3D;&#x2F;oracle&#x2F;install&#x2F;rspfmt_crsinstall_response_schema_v19.0.0 \</span><br><span class="line">INVENTORY_LOCATION&#x3D;&#x2F;u01&#x2F;app&#x2F;oraInventory \</span><br><span class="line">oracle.install.option&#x3D;HA_CONFIG \</span><br><span class="line">ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;grid \</span><br><span class="line">oracle.install.asm.OSDBA&#x3D;asmdba \</span><br><span class="line">oracle.install.asm.OSOPER&#x3D;asmoper \</span><br><span class="line">oracle.install.asm.OSASM&#x3D;asmadmin \</span><br><span class="line">oracle.install.asm.SYSASMPassword&#x3D;&lt;password&gt; \</span><br><span class="line">oracle.install.asm.monitorPassword&#x3D;&lt;password&gt; \</span><br><span class="line">oracle.install.crs.config.scanType&#x3D;LOCAL_SCAN \</span><br><span class="line">oracle.install.crs.config.ClusterConfiguration&#x3D;STANDALONE \</span><br><span class="line">oracle.install.crs.config.configureAsExtendedCluster&#x3D;false \</span><br><span class="line">oracle.install.crs.config.useIPMI&#x3D;false \</span><br><span class="line">oracle.install.asm.storageOption&#x3D;ASM \</span><br><span class="line">oracle.install.asm.diskGroup.name&#x3D;OCR \</span><br><span class="line">oracle.install.asm.diskGroup.redundancy&#x3D;EXTERNAL \</span><br><span class="line">oracle.install.asm.diskGroup.AUSize&#x3D;4 \</span><br><span class="line">oracle.install.asm.diskGroup.disksWithFailureGroupNames&#x3D;&#x2F;dev&#x2F;raw&#x2F;raw1,,&#x2F;dev&#x2F;raw&#x2F;raw2,,&#x2F;dev&#x2F;raw&#x2F;raw3, \</span><br><span class="line">oracle.install.asm.diskGroup.disks&#x3D;&#x2F;dev&#x2F;raw&#x2F;raw1,&#x2F;dev&#x2F;raw&#x2F;raw2,&#x2F;dev&#x2F;raw&#x2F;raw3 \</span><br><span class="line">oracle.install.asm.diskGroup.diskDiscoveryString&#x3D;&#x2F;dev&#x2F;raw&#x2F;raw* \</span><br><span class="line">oracle.install.crs.rootconfig.executeRootScript&#x3D;false</span><br></pre></td></tr></table></figure>

<p>根据提示，使用 root 跑脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;u01&#x2F;app&#x2F;oraInventory&#x2F;orainstRoot.sh</span><br><span class="line"># &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;root.sh</span><br></pre></td></tr></table></figure>

<p>在使用 grid 跑脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;gridSetup.sh -silent -executeConfigTools -responseFile &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;install&#x2F;response&#x2F;grid_2020-03-27_03-19-28PM.rsp</span><br></pre></td></tr></table></figure>

<h3 id="创建-ASM-实例"><a href="#创建-ASM-实例" class="headerlink" title="创建 ASM 实例"></a>创建 ASM 实例</h3><p>图形化创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;bin&#x2F;asmca</span><br></pre></td></tr></table></figure>

<p>静默</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ &#x2F;u01&#x2F;app&#x2F;19.3.0&#x2F;grid&#x2F;bin&#x2F;asmca -silent -configureASM \</span><br><span class="line">-sysAsmPassword &lt;password&gt; \</span><br><span class="line">-asmsnmpPassword &lt;password&gt; \</span><br><span class="line">-diskString &#39;&#x2F;dev&#x2F;raw&#x2F;raw*&#39; \</span><br><span class="line">-diskGroupName OCR \</span><br><span class="line">-diskList &#x2F;dev&#x2F;raw&#x2F;raw1,&#x2F;dev&#x2F;raw&#x2F;raw2,&#x2F;dev&#x2F;raw&#x2F;raw3 \</span><br><span class="line">-redundancy EXTERNAL</span><br></pre></td></tr></table></figure>

<h3 id="创建监听"><a href="#创建监听" class="headerlink" title="创建监听"></a>创建监听</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ netca -silent -responsefile $ORACLE_HOME&#x2F;assistants&#x2F;netca&#x2F;netca.rsp</span><br><span class="line">$ netca -silent -responsefile $ORACLE_HOME&#x2F;assistants&#x2F;netca&#x2F;netca.rsp -instype custom -listener LISTENER -lisport 1521</span><br><span class="line">$ netca -silent -responsefile $ORACLE_HOME&#x2F;assistants&#x2F;netca&#x2F;netca.rsp -instype custom -listener LISTENER_1522 -lisport 1522</span><br></pre></td></tr></table></figure>

<h3 id="创建-DATA-和-FRA-磁盘组"><a href="#创建-DATA-和-FRA-磁盘组" class="headerlink" title="创建 DATA 和 FRA 磁盘组"></a>创建 DATA 和 FRA 磁盘组</h3><p>查询 ASM 磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># $GRID_HOME&#x2F;bin&#x2F;kfod disks&#x3D;asm  st&#x3D;true ds&#x3D;true cluster&#x3D;true</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; alter system set asm_diskstring&#x3D;&#39;&#x2F;dev&#x2F;raw&#x2F;raw*&#39;,&#39;&#x2F;dev&#x2F;asm-*&#39;;</span><br><span class="line"></span><br><span class="line">sql&gt; col name format a10</span><br><span class="line">sql&gt; set line 9999</span><br><span class="line">sql&gt; col path format a25</span><br><span class="line">sql&gt; select GROUP_NUMBER,path,name,disk_number,total_mb,free_mb,CREATE_DATE,MOUNT_STATUS,MOUNT_DATE from v$asm_disk order by GROUP_NUMBER desc,disk_number;</span><br><span class="line">sql&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># su - grid</span><br><span class="line">$ asmcmd</span><br><span class="line">ASMCMD&gt; create diskgroup DATA external redundancy disk &#39;&#x2F;dev&#x2F;asm-diski&#39;,&#39;&#x2F;dev&#x2F;asm-diskj&#39;,&#39;&#x2F;dev&#x2F;asm-diskk&#39;  ATTRIBUTE &#39;compatible.rdbms&#39; &#x3D; &#39;19.0&#39;, &#39;compatible.asm&#39; &#x3D; &#39;19.0&#39;;</span><br><span class="line">ASMCMD&gt; create diskgroup FRA external redundancy disk &#39;&#x2F;dev&#x2F;asm-diskl&#39;,&#39;&#x2F;dev&#x2F;asm-diskm&#39;,&#39;&#x2F;dev&#x2F;asm-diskn&#39;  ATTRIBUTE &#39;compatible.rdbms&#39; &#x3D; &#39;19.0&#39;, &#39;compatible.asm&#39; &#x3D; &#39;19.0&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="静默安装-db-软件"><a href="#静默安装-db-软件" class="headerlink" title="静默安装 db 软件"></a>静默安装 db 软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su - oracle</span><br><span class="line">$ cd $ORACLE_HOME</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.3.0&#x2F;dbhome_1&#x2F;runInstaller -silent  -force -noconfig  -ignorePrereq \</span><br><span class="line">oracle.install.responseFileVersion&#x3D;oracle.install.responseFileVersion&#x3D;&#x2F;oracle&#x2F;install&#x2F;rspfmt_dbinstall_response_schema_v19.0.0 \</span><br><span class="line">oracle.install.option&#x3D;INSTALL_DB_SWONLY \</span><br><span class="line">UNIX_GROUP_NAME&#x3D;oinstall \</span><br><span class="line">INVENTORY_LOCATION&#x3D;&#x2F;u01&#x2F;app&#x2F;oraInventory \</span><br><span class="line">ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle \</span><br><span class="line">oracle.install.db.InstallEdition&#x3D;EE \</span><br><span class="line">oracle.install.db.OSDBA_GROUP&#x3D;dba \</span><br><span class="line">oracle.install.db.OSOPER_GROUP&#x3D;oper \</span><br><span class="line">oracle.install.db.OSBACKUPDBA_GROUP&#x3D;backupdba \</span><br><span class="line">oracle.install.db.OSDGDBA_GROUP&#x3D;dgdba \</span><br><span class="line">oracle.install.db.OSKMDBA_GROUP&#x3D;kmdba \</span><br><span class="line">oracle.install.db.OSRACDBA_GROUP&#x3D;racdba</span><br></pre></td></tr></table></figure>

<p>以 root 用户，执行脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.3.0&#x2F;dbhome_1&#x2F;root.sh</span><br></pre></td></tr></table></figure>

<h2 id="dbca-静默建库"><a href="#dbca-静默建库" class="headerlink" title="dbca 静默建库"></a>dbca 静默建库</h2><p>PDB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># su - oracle</span><br><span class="line">$ dbca -silent -ignorePreReqs  -ignorePrereqFailure  -createDatabase -templateName General_Purpose.dbc -responseFile NO_VALUE \</span><br><span class="line">-gdbname ocp19cdb -sid ocp19cdb \</span><br><span class="line">-createAsContainerDatabase TRUE \</span><br><span class="line">-sysPassword &lt;password&gt; -systemPassword &lt;password&gt; -pdbAdminPassword &lt;password&gt; -dbsnmpPassword &lt;password&gt; \</span><br><span class="line">-datafileDestination &#39;+DATA&#39; -recoveryAreaDestination &#39;+FRA&#39; \</span><br><span class="line">-storageType ASM \</span><br><span class="line">-characterset AL32UTF8 \</span><br><span class="line">-sampleSchema true \</span><br><span class="line">-totalMemory 1024 \</span><br><span class="line">-databaseType MULTIPURPOSE \</span><br><span class="line">-emConfiguration NONE</span><br></pre></td></tr></table></figure>

<p>CDB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># su - oracle</span><br><span class="line">$ dbca -silent -ignorePreReqs  -ignorePrereqFailure  -createDatabase -templateName General_Purpose.dbc -responseFile NO_VALUE \</span><br><span class="line">-gdbname ocp19sdb -sid ocpsdb \</span><br><span class="line">-createAsContainerDatabase FALSE \</span><br><span class="line">-sysPassword &lt;password&gt; -systemPassword &lt;password&gt; -dbsnmpPassword &lt;password&gt; \</span><br><span class="line">-datafileDestination &#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#39; -recoveryAreaDestination &#39;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;flash_recovery_area&#39; \</span><br><span class="line">-storageType FS \</span><br><span class="line">-characterset ZHS16GBK \</span><br><span class="line">-sampleSchema true \</span><br><span class="line">-totalMemory 600 \</span><br><span class="line">-databaseType MULTIPURPOSE \</span><br><span class="line">-emConfiguration NONE</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>haona_li
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://ilxy.tech/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/" title="OCP 0002 19c Standalone Oracle Restart">https://ilxy.tech/blog/2020/04/04/OCP-0002-19c-Standalone-Oracle-Restart/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/blog/tags/oracle/" rel="tag"><i class="fa fa-tag"></i> oracle</a>
              <a href="/blog/tags/ocp/" rel="tag"><i class="fa fa-tag"></i> ocp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2020/04/04/OCP-0001-Install-CentOS-7/" rel="prev" title="OCP 0001 Install CentOS 7">
      <i class="fa fa-chevron-left"></i> OCP 0001 Install CentOS 7
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2020/05/18/hyper-v-use-nat/" rel="next" title="hyper-v NAT 网络使用固定 IP">
      hyper-v NAT 网络使用固定 IP <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#19c-Standalone（Oralce-Restart）"><span class="nav-number">1.</span> <span class="nav-text">19c Standalone（Oralce Restart）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#操作系统配置"><span class="nav-number">1.1.</span> <span class="nav-text">操作系统配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭防火墙"><span class="nav-number">1.1.1.</span> <span class="nav-text">关闭防火墙</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#禁用-Selinux"><span class="nav-number">1.1.2.</span> <span class="nav-text">禁用 Selinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户、组、目录和环境变量"><span class="nav-number">1.1.3.</span> <span class="nav-text">用户、组、目录和环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖包的检查"><span class="nav-number">1.1.4.</span> <span class="nav-text">依赖包的检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置内核参数"><span class="nav-number">1.1.5.</span> <span class="nav-text">配置内核参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-dev-shm-大小"><span class="nav-number">1.1.6.</span> <span class="nav-text">配置 &#x2F;dev&#x2F;shm 大小</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-ASM-磁盘"><span class="nav-number">1.2.</span> <span class="nav-text">配置 ASM 磁盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Faking-方式"><span class="nav-number">1.2.1.</span> <span class="nav-text">Faking 方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VMware-Workstation-软件（可做-rac-共享盘）"><span class="nav-number">1.2.2.</span> <span class="nav-text">VMware Workstation 软件（可做 rac 共享盘）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#openfiler（可做-rac-共享盘）"><span class="nav-number">1.2.3.</span> <span class="nav-text">openfiler（可做 rac 共享盘）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASMLIB（可做-rac-共享盘）"><span class="nav-number">1.2.4.</span> <span class="nav-text">ASMLIB（可做 rac 共享盘）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iSCSI-方式（可做-rac-共享盘）"><span class="nav-number">1.2.5.</span> <span class="nav-text">iSCSI 方式（可做 rac 共享盘）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库软件准备"><span class="nav-number">1.3.</span> <span class="nav-text">数据库软件准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#上传安装文件"><span class="nav-number">1.3.1.</span> <span class="nav-text">上传安装文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解压文件"><span class="nav-number">1.3.2.</span> <span class="nav-text">解压文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#卸载"><span class="nav-number">1.4.</span> <span class="nav-text">卸载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图形化安装-grid-和-db"><span class="nav-number">1.5.</span> <span class="nav-text">图形化安装 grid 和 db</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#grid"><span class="nav-number">1.5.1.</span> <span class="nav-text">grid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#db"><span class="nav-number">1.5.2.</span> <span class="nav-text">db</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静默安装-grid"><span class="nav-number">1.6.</span> <span class="nav-text">静默安装 grid</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">1.6.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-ASM-实例"><span class="nav-number">1.6.2.</span> <span class="nav-text">创建 ASM 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建监听"><span class="nav-number">1.6.3.</span> <span class="nav-text">创建监听</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-DATA-和-FRA-磁盘组"><span class="nav-number">1.6.4.</span> <span class="nav-text">创建 DATA 和 FRA 磁盘组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静默安装-db-软件"><span class="nav-number">1.7.</span> <span class="nav-text">静默安装 db 软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dbca-静默建库"><span class="nav-number">1.8.</span> <span class="nav-text">dbca 静默建库</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="haona_li"
      src="/blog/images/Tiger.jpg">
  <p class="site-author-name" itemprop="name">haona_li</p>
  <div class="site-description" itemprop="description">百川东到海，何时复西归</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haona_li</span>
</div>

        






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.dataset.flagTitle;

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=ThEhxcX5E2Gkc43njpEWXo13-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : 'ThEhxcX5E2Gkc43njpEWXo13-gzGzoHsz',
            'X-LC-Key'    : 'ABhMqo6t0zS2nCJAVeKbvfRG',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ThEhxcX5E2Gkc43njpEWXo13-gzGzoHsz',
      appKey     : 'ABhMqo6t0zS2nCJAVeKbvfRG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/blog/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
